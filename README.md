# Image Segmentation with PSPNet and SLIC

This project utilizes an image segmentation model (PSPNet) and the SLIC (Simple Linear Iterative Clustering) algorithm to segment images and adjust the segments coherently. The script takes an input image, segments it, applies SLIC to obtain superpixels, and adjusts the classes of these superpixels based on the predominant class in each cluster. All images to be segmented are first transformed into square images by resizing them to a square with a side length of max(height, width).

## Table of Contents
- [Illustrations](#llustrations)
- [Project Structure](#project-structure)
- [Set up](#set-up)
- [Usage](#usage)


## Illustrations
<div style="display: flex; justify-content: space-between;"> <img src="visual\img_sge.PNG" alt="Use of segmentation on aerial imagery" width="100%" /> </div>

After this processing, we can use SLIC and retain the main class for each superpixel created to increase the accuracy. The following pictures are the result for different parameters of SLIC (No. of segments: 1,000, compaction: 10) and (No. of segments: 10,000, compaction: 40).

.<div style="display: flex; justify-content: space-between;"> <img src="visual\img_slic.PNG" alt="Use of segmentation on aerial imagery" width="100%" /> </div>

## Project Structure

- `segmentation/inference.py`: Contains functions to load the model and perform inference on images.
- `slic/slic.py`: Contains the implementation of the SLIC algorithm to generate superpixels.

## Set Up
To install dependencies, run:

```bash
pip install -r requirements.txt
```
## Usage

To execute the script, use the following command:

```bash
python run.py \
    --model_path <path_to_model> \
    --img_path <path_to_image> \
    --out_path_array <path_to_output_array> \
    --out_path_image1 <path_to_output_image1> \
    --slic_contours_path <path_to_slic_contours> \
    --slic_clusters_path <path_to_slic_clusters> \
    --out_path_image2 <path_to_output_image2>
```

### Arguments

- `--model_path`: Path to the pre-trained PSPNet model file.
- `--img_path`: Path to the input image to segment.
- `--out_path_array`: Path to save the segmentation mask in numpy format.
- `--out_path_image1`: Path to save the segmentation mask in image format.
- `--slic_contours_path`: Path to save the contours generated by SLIC (numpy format).
- `--slic_clusters_path`: Path to save the clusters generated by SLIC (numpy format).
- `--out_path_image2`: Path to save the final mask adjusted by SLIC.

The `subpro.py` script generates segmentations for the entire set of queries.

You can also attempt to retrain the model using the `segmentation/training.py` script and training data from FloodNet.
